!function(){function e(){this._stageW=800,this._stageH=550,this._foeCreatePos=[{x:100,y:80},{x:this._stageW/2,y:80},{x:this._stageW-100,y:80}],this._myCreatePos={x:this._stageW/2,y:this._stageH-80},this._foeCreateTime=150,this._foeNumTotal=10}e.prototype={bindStage:function(){var e=this;e._stage=new Konva.Stage({width:e._stageW,height:e._stageH,container:"contentDiv",listening:!0}),e._layer=new Konva.Layer;var t=new Konva.FastLayer,a=new Konva.Image({width:e._stageW,height:e._stageH,x:0,y:0});t.add(a),e._back.onload=function(){a.image(e._back),t.draw()},e._stage.add(t),e._stage.add(e._layer),e.addStart(),e._stage.on("click",function(){var t=e._layer.getIntersection(e._stage.getPointerPosition(),"Text");if(t)if(t==e._startText)e.init(),e.gameStart();else if(t==e._overText){e._stage.removeChildren(),e._layer=new Konva.Layer;var a=new Konva.FastLayer,r=new Konva.Image({width:e._stageW,height:e._stageH,x:0,y:0,image:e._back});a.add(r),e._stage.add(a),e._stage.add(e._layer),e.init(),e.gameStart()}})},init:function(){this._foeNum=this._foeNumTotal,this._createdFoe=0,this._myNum=1,this._foePosIndex=1,this._useTime=0,this._foeArr=[],this._myArr=[]},uninit:function(){this._foeNum=this._foeNumTotal,this._createdFoe=0,this._myNum=1,this._foePosIndex=1,this._useTime=0,this._foeArr=[],this._myArr=[]},addStart:function(){var e=this;e._startText=new Konva.Text({text:"Game Start",fill:"rgb(84,38,26)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var t=e._startText.width(),a=e._startText.height();e._startText.x(e._stageW/2-t/2),e._startText.y(e._stageH/2-a/2),e._layer.add(e._startText),e._layer.batchDraw()},addOver:function(){var e=this;e._total=new Konva.Text({text:"Your Score:"+(e._foeNumTotal-e._foeNum),fill:"rgb(64,120,255)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var t=e._total.width(),a=e._total.height();e._total.x(e._stageW/2-t/2),e._total.y(e._stageH/2-a/2-20),e._overText=new Konva.Text({text:"Restart",fill:"rgb(84,38,26)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var r=e._overText.width(),o=e._overText.height();e._overText.x(e._stageW/2-r/2),e._overText.y(e._stageH/2+o/2-20),e._layer.add(e._total),e._layer.add(e._overText),e._layer.batchDraw()},addSuccess:function(){var e=this;e._total=new Konva.Text({text:"You Success!",fill:"rgb(64,120,255)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var t=e._total.width(),a=e._total.height();e._total.x(e._stageW/2-t/2),e._total.y(e._stageH/2-a/2-20),e._overText=new Konva.Text({text:"Restart",fill:"rgb(168,120,79)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var r=e._overText.width(),o=e._overText.height();e._overText.x(e._stageW/2-r/2),e._overText.y(e._stageH/2+o/2-20),e._layer.add(e._total),e._layer.add(e._overText),e._layer.batchDraw()},gameStart:function(){var e=this;e._startText?(e._startText.destroy(),e._startText=null):(e._total.destroy(),e._overText.destroy(),e._overText=null,e._total=null),e.createMyTank(e._myCreatePos);var t=function(){if(e._createdFoe<e._foeNumTotal&&(0==e._useTime&&(e.createFoeTank(e._foeCreatePos[e._foePosIndex]),e._createdFoe++,++e._foePosIndex>=e._foeCreatePos.length&&(e._foePosIndex=0)),e._useTime++),e._useTime==e._foeCreateTime&&(e._useTime=0),0==e._foeNum)return void e.gameSuccess();if(0==e._myNum)return void e.gameOver();if(e._foeArr&&e._foeArr.length>0)for(var a=0;a<e._foeArr.length;a++)!function(t){var a=e._foeArr[t];if(a._destroyed)return a=null,e._foeArr.splice(t,1),void e._foeNum--;a.tankMove()}(a);if(e._myArr&&e._myArr.length>0)for(var a=0;a<e._myArr.length;a++)!function(t){var a=e._myArr[t];if(a._destroyed)return a=null,e._myArr.splice(t,1),void e._myNum--;a.tankMove()}(a);e._layer.batchDraw(),e._requestId=requestAnimationFrame(t)};t();var a=function(t){e._myArr[0]._moveAble=!0,e._myArr[0]._moveV=5,e._myArr[0].directChange(t),e._continuing=!0},r=function(){e._myArr.length>0&&(e._myArr[0]._moveAble=!1,e._myArr[0]._moveV=0)};$(document).on("keydown",function(t){if(t.preventDefault(),!(e._myArr.length<=0))switch(t.keyCode){case 37:a(3);break;case 38:a(0);break;case 39:a(1);break;case 40:a(2);break;case 32:e._myArr[0].fireBullet();break;default:e._continuing=!1}}),$(document).on("keyup",function(e){e.preventDefault(),r()})},gameOver:function(){var e=this;window.cancelAnimationFrame(e._requestId),e.addOver(),e.uninit()},gameSuccess:function(){var e=this;window.cancelAnimationFrame(e._requestId),e.addSuccess(),e.uninit()},createFoeTank:function(e){var t=new window.FoeTank(this._stage,this._layer);switch(t.selectType(),t._tankType){case 0:t.createTank(e,this._tankType0);break;case 1:t.createTank(e,this._tankType1);break;case 2:t.createTank(e,this._tankType2)}this._foeArr.push(t)},createMyTank:function(e){var t=new window.MyTank(this._stage,this._layer);t.createTank(e,this._tankType3),this._myArr.push(t)},passNumChange:function(){var e=this;0==e._passedNum?(e._totalText=new Konva.Text({fontSize:20,fill:"#333",x:20,y:20,text:"Total:"+e._passedNum}),e._layer.add(e._totalText),e._layer.batchDraw()):(e._totalText.text("Total:"+e._passedNum),e._layer.batchDraw())}},window.Main=e}();
//# sourceMappingURL=main.min.js.map
