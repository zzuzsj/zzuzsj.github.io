{"version":3,"sources":["js/game/tank/bullet.js"],"names":["Bullet","stage","layer","this","_bulletW","_bulletH","_buletIndex","_curBulletObj","_bstage","_blayer","_destroyed","prototype","selectType","type","_moveV","_carryer","_effectTarget","createBullet","dir","pos","_dir","that","_curBullet","Konva","Rect","width","height","offset","x","y","name","effectTarget","bulletIndex","fill","rotation","add","batchDraw","bulletMove","hitJudge","cx","cy","target","getIntersection","getAttr","setAttr","destroy","_sw","_sh","window"],"mappings":"CAAA,WACI,QAASA,GAAOC,EAAOC,GACnBC,KAAKC,SAAW,EAChBD,KAAKE,SAAW,EAChBF,KAAKG,YAAc,EACnBH,KAAKI,iBACLJ,KAAKK,QAAUP,EACfE,KAAKM,QAAUP,EACfC,KAAKO,YAAa,EAEtBV,EAAOW,WACHC,WAAY,SAAUC,GAClB,OAAQA,GACJ,IAAK,GAKL,IAAK,GACDV,KAAKW,OAAS,EACdX,KAAKY,SAAW,WAChBZ,KAAKa,cAAgB,QACrB,MACJ,KAAK,GACDb,KAAKW,OAAS,EACdX,KAAKY,SAAW,WAChBZ,KAAKa,cAAgB,QACrB,MACJ,KAAK,GACDb,KAAKW,OAAS,EACdX,KAAKY,SAAW,UAChBZ,KAAKa,cAAgB,YAMjCC,aAAc,SAAUC,EAAKC,GACzBhB,KAAKiB,KAAOF,CACZ,IAAIG,GAAOlB,IACXkB,GAAKf,cACLe,EAAKd,cAAcc,EAAKf,aAAee,EAAKC,WAC5CD,EAAKC,WAAa,GAAIC,OAAMC,MACxBC,MAAOJ,EAAKjB,SACZsB,OAAQL,EAAKhB,SACbsB,QACIC,EAAGP,EAAKjB,SAAW,EACnByB,EAAGR,EAAKhB,SAAW,GAEvBuB,EAAGT,EAAIS,EACPC,EAAGV,EAAIU,EACPC,KAAMT,EAAKN,SACXgB,aAAcV,EAAKL,cACnBgB,YAAaX,EAAKf,YAClB2B,KAAM,QACNC,SAAgB,GAANhB,IAEdG,EAAKZ,QAAQ0B,IAAId,EAAKC,YACtBD,EAAKZ,QAAQ2B,aAEjBC,WAAY,WACR,GAAIT,GAAIzB,KAAKmB,WAAWM,IACpBC,EAAI1B,KAAKmB,WAAWO,GACxB,QAAQ1B,KAAKiB,MACT,IAAK,GACDjB,KAAKmB,WAAWO,EAAEA,EAAI1B,KAAKW,OAC3B,MACJ,KAAK,GACDX,KAAKmB,WAAWM,EAAEA,EAAIzB,KAAKW,OAC3B,MACJ,KAAK,GACDX,KAAKmB,WAAWO,EAAEA,EAAI1B,KAAKW,OAC3B,MACJ,KAAK,GACDX,KAAKmB,WAAWM,EAAEA,EAAIzB,KAAKW,QAKnCX,KAAKmC,YAETA,SAAU,WACN,GAAIC,GAAKpC,KAAKmB,WAAWM,IACrBY,EAAKrC,KAAKmB,WAAWO,IACrBY,EAAStC,KAAKK,QAAQkC,iBACtBd,EAAGW,EACHV,EAAGW,GACJ,IAAIrC,KAAKmB,WAAWqB,QAAQ,gBAC/B,IAAIF,EAKA,MAJAA,GAAOG,QAAQ,aAAY,GAC3BH,EAAOI,UACP1C,KAAKmB,WAAWuB,eAChB1C,KAAKO,YAAa,EAGtB,QAAQP,KAAKiB,MACT,IAAK,GAED,KADSoB,EAAKrC,KAAKE,SAAW,EACrB,GAIL,MAHAF,MAAKmB,WAAWuB,UAChB1C,KAAKO,YAAa,CAItB,MACJ,KAAK,GAED,KADS6B,EAAKpC,KAAKE,SAAW,EACrBF,KAAK2C,KAIV,MAHA3C,MAAKmB,WAAWuB,UAChB1C,KAAKO,YAAa,CAI1B,KAAK,GAED,KADS8B,EAAKrC,KAAKE,SAAW,EACrBF,KAAK4C,KAIV,MAHA5C,MAAKmB,WAAWuB,UAChB1C,KAAKO,YAAa,CAI1B,KAAK,GAED,KADS6B,EAAKpC,KAAKE,SAAW,EACrB,GAIL,MAHAF,MAAKmB,WAAWuB,UAChB1C,KAAKO,YAAa,KAUtCsC,OAAOhD,OAASA","file":"bullet.min.js","sourcesContent":["(function () {\r\n    function Bullet(stage, layer) {\r\n        this._bulletW = 2;\r\n        this._bulletH = 4;\r\n        this._buletIndex = 0;\r\n        this._curBulletObj = {};\r\n        this._bstage = stage;\r\n        this._blayer = layer;\r\n        this._destroyed = false;\r\n    }\r\n    Bullet.prototype = {\r\n        selectType: function (type) {\r\n            switch (type) {\r\n                case 0:\r\n                    this._moveV = 8;\r\n                    this._carryer = 'foetankb';\r\n                    this._effectTarget = 'myTank';\r\n                    break;\r\n                case 1:\r\n                    this._moveV = 8;\r\n                    this._carryer = 'foetankb';\r\n                    this._effectTarget = 'myTank';\r\n                    break;\r\n                case 2:\r\n                    this._moveV = 9;\r\n                    this._carryer = 'foetankb';\r\n                    this._effectTarget = 'myTank';\r\n                    break;\r\n                case 3:\r\n                    this._moveV = 8;\r\n                    this._carryer = 'mytankb';\r\n                    this._effectTarget = 'foeTank';\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        },\r\n        createBullet: function (dir, pos) {\r\n            this._dir = dir;\r\n            var that = this;\r\n            that._buletIndex++;\r\n            that._curBulletObj[that._buletIndex] = that._curBullet;\r\n            that._curBullet = new Konva.Rect({\r\n                width: that._bulletW,\r\n                height: that._bulletH,\r\n                offset: {\r\n                    x: that._bulletW / 2,\r\n                    y: that._bulletH / 2\r\n                },\r\n                x: pos.x,\r\n                y: pos.y,\r\n                name: that._carryer,\r\n                effectTarget: that._effectTarget,\r\n                bulletIndex: that._buletIndex,\r\n                fill: 'white',\r\n                rotation: dir * 90\r\n            });\r\n            that._blayer.add(that._curBullet);\r\n            that._blayer.batchDraw();\r\n        },\r\n        bulletMove: function () {\r\n            var x = this._curBullet.x();\r\n            var y = this._curBullet.y();\r\n            switch (this._dir) {\r\n                case 0:\r\n                    this._curBullet.y(y - this._moveV);\r\n                    break;\r\n                case 1:\r\n                    this._curBullet.x(x + this._moveV);\r\n                    break;\r\n                case 2:\r\n                    this._curBullet.y(y + this._moveV);\r\n                    break;\r\n                case 3:\r\n                    this._curBullet.x(x - this._moveV);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            this.hitJudge();\r\n        },\r\n        hitJudge: function () {\r\n            var cx = this._curBullet.x();\r\n            var cy = this._curBullet.y();\r\n            var target = this._bstage.getIntersection({\r\n                x: cx,\r\n                y: cy\r\n            }, '.'+this._curBullet.getAttr('effectTarget'));\r\n            if (target) {\r\n                target.setAttr('destroyed',true);\r\n                target.destroy();\r\n                this._curBullet.destroy();\r\n                this._destroyed = true;\r\n                return;\r\n            }\r\n            switch (this._dir) {\r\n                case 0:\r\n                    var ct = cy - this._bulletH / 2;\r\n                    if (ct < 0) {\r\n                        this._curBullet.destroy();\r\n                        this._destroyed = true;\r\n                    } else {\r\n                        return;\r\n                    }\r\n                    break;\r\n                case 1:\r\n                    var cr = cx + this._bulletH / 2;\r\n                    if (cr > this._sw) {\r\n                        this._curBullet.destroy();\r\n                        this._destroyed = true;\r\n                    } else {\r\n                        return;\r\n                    }\r\n                case 2:\r\n                    var cb = cy + this._bulletH / 2;\r\n                    if (cb > this._sh) {\r\n                        this._curBullet.destroy();\r\n                        this._destroyed = true;\r\n                    } else {\r\n                        return;\r\n                    }\r\n                case 3:\r\n                    var cl = cx - this._bulletH / 2;\r\n                    if (cl < 0) {\r\n                        this._curBullet.destroy();\r\n                        this._destroyed = true;\r\n                    } else {\r\n                        return;\r\n                    }\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    window.Bullet = Bullet;\r\n})();"]}