!function(){function t(){this._stageW=600,this._stageH=400,this._moveV=5,this._accelertV=-.35,this._addYV=6,this._startX=100,this._startY=150,this._birdScaleW=50,this._birdScaleH=50,this._pipeW=60,this._pipeSpace=300}t.prototype={bindStage:function(){var t=this;t._stage=new Konva.Stage({width:t._stageW,height:t._stageH,container:"contentDiv",listening:!0}),t._layer=new Konva.Layer,t._stage.add(t._layer),t.addStart(),t._stage.on("click",function(){var e=t._layer.getIntersection(t._stage.getPointerPosition(),"Text");e&&(e==t._startText?(t.init(),t.gameStart()):e==t._overText&&(t._stage.removeChildren(),t._layer=new Konva.Layer,t._stage.add(t._layer),t.init(),t.gameStart()))})},init:function(){this._startYV=0,this._birdYV=0,this._useTime=0,this._pipeArr=[],this._requestId=null,this._passedNum=0,this._totalText=null},uninit:function(){this._startYV=0,this._birdYV=0,this._useTime=0,this._requestId=null,this._passedNum=0,this._totalText=null,this._pipeArr=[]},addStart:function(){var t=this;t._startText=new Konva.Text({text:"Game Start",fill:"rgb(168,120,79)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var e=t._startText.width(),a=t._startText.height();t._startText.x(t._stageW/2-e/2),t._startText.y(t._stageH/2-a/2),t._layer.add(t._startText),t._layer.batchDraw()},addOver:function(){var t=this;t._total=new Konva.Text({text:"Your Score:"+t._passedNum,fill:"rgb(64,120,255)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var e=t._total.width(),a=t._total.height();t._total.x(t._stageW/2-e/2),t._total.y(t._stageH/2-a/2-20),t._overText=new Konva.Text({text:"Restart",fill:"rgb(168,120,79)",fontStyle:"bold",fontSize:30,fontFamily:"Times New Roman"});var i=t._overText.width(),r=t._overText.height();t._overText.x(t._stageW/2-i/2),t._overText.y(t._stageH/2+r/2-20),t._layer.add(t._total),t._layer.add(t._overText),t._layer.batchDraw()},gameStart:function(){var t=this;t._stage.listening(!1),t.createBird(),t.passNumChange(),t._startText?(t._startText.destroy(),t._startText=null):(t._total.destroy(),t._overText.destroy(),t._overText=null,t._total=null);var e=function(){t._useTime++,t._useTime%60==0&&t.createPipe(),t.pipeMove(),t.birdDrop(),t._layer.batchDraw(),t._requestId=requestAnimationFrame(e),t.hitJudge()};e(),$("#contentDiv").on("click",function(){t.birdJump()})},gameOver:function(){var t=this;window.cancelAnimationFrame(t._requestId),t._stage.listening(!0),t.addOver(),t.uninit()},passNumChange:function(){var t=this;0==t._passedNum?(t._totalText=new Konva.Text({fontSize:20,fill:"#333",x:20,y:20,text:"Total:"+t._passedNum}),t._layer.add(t._totalText),t._layer.batchDraw()):(t._totalText.text("Total:"+t._passedNum),t._layer.batchDraw())},createBird:function(){var t=this,e=new Image;e.src="./res/game/flappy/LOGO.png",t._flappyBird=new Konva.Image({width:t._birdScaleW,height:t._birdScaleH,x:t._startX,y:t._startY,name:"bird"}),e.onload=function(){t._flappyBird.image(e),t._layer.batchDraw()},t._layer.add(t._flappyBird),t._layer.batchDraw()},birdDrop:function(){var t=this;t._flappyBird.y(t._flappyBird.y()-t._birdYV),t._birdYV+=t._accelertV},birdJump:function(){this._birdYV=this._addYV},createPipe:function(){var t=this._stageH-130,e=Math.floor(Math.random()*(this._stageH-200))+20,a=t-e,i=this,r=new Konva.Group({x:i._stageW,y:0,width:i._pipeW,height:i._stageH,name:"pipeGroup",upY:e,lowY:i._stageH-a});i._pipeArr.push(r);var _=new Konva.Rect({width:this._pipeW,height:e,x:0,y:0,fill:"green"}),s=new Konva.Rect({width:this._pipeW,height:a,x:0,y:i._stageH-a,fill:"green"});r.add(_),r.add(s),i._layer.add(r),i._layer.batchDraw()},pipeMove:function(){var t=this;if(0!=t._pipeArr.length)for(var e=0;e<t._pipeArr.length;e++)!function(e){var a=t._pipeArr[e];if(a.x(a.x()-t._moveV),a.x()+t._pipeW==t._startX)t._passedNum++,t.passNumChange();else if(a.x()<-t._pipeW)a.destroy(),t._pipeArr.splice(0,1)}(e)},hitJudge:function(){var t=this;if(0!=t._pipeArr.length){var e=t._pipeArr[0],a=e.x();if(!(a>t._startX+t._birdScaleW||a+t._pipeW<t._startX)){var i=e.getAttr("upY"),r=e.getAttr("lowY"),_=t._flappyBird.y(),s=t._flappyBird.y()+t._birdScaleH;(_<i||s>r)&&t._requestId&&t.gameOver()}}}},window.Flappy=t}();
//# sourceMappingURL=flappy.min.js.map
