{"version":3,"sources":["js/index/trail.js"],"names":["window","zsj","Trail","width","height","this","canvasWidth","canvasHeight","prototype","create","options","trial","trail","moveStyle","startPos","endPos","duration","starttime","endtime","rotatedir","rotatecount","ctrlPos1","ctrlPos2","_step","step","_rotatedcount","_movedtime","curPos","selectTrail","getDistance","p1","p2","Math","sqrt","pow","x","y","calculateAngle","figureX","figureY","orignX","orignY","oAngle","cx","cy","tanValue","atan","PI","curve2equation","t","p0","curve3equation","p3","_rateX","_rateY","floor","random","_r","_startAngle","_rateR","controlTime","mt","calculatePos","pos","curt","curAngle","sin","cos","controlMove"],"mappings":"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","file":"trail.min.js","sourcesContent":["window.zsj = window.zsj || {};\r\n(function () {\r\n    function Trail(width, height) {\r\n        this.canvasWidth = width;\r\n        this.canvasHeight = height;\r\n    }\r\n    Trail.prototype = {\r\n        create: function (options) {\r\n            this.trial = options.trail;//移动轨迹\r\n            this.moveStyle = options.moveStyle;//移动方式\r\n            this.startPos = options.startPos;//初始目标点\r\n            this.endPos = options.endPos;//最终目的点 或者是 圆心\r\n            this.duration = options.duration;//移动时间\r\n            this.starttime = options.starttime || 0;//开始运动时间点\r\n            this.endtime = this.starttime + this.duration;//结束运动时间点\r\n            this.rotatedir = options.rotatedir || 0;//0 为顺时针 1 为逆时针\r\n            this.rotatecount = options.rotatecount || 0;//0 为一直转 整数位旋转次数\r\n            this.ctrlPos1 = options.ctrlPos1 || null;\r\n            this.ctrlPos2 = options.ctrlPos2 || null;\r\n            this._step = options.step || 1;\r\n            this._rotatedcount = 0;\r\n            this._movedtime = 0;\r\n            this.curPos = this.startPos;\r\n            this.selectTrail();\r\n        },\r\n        getDistance: function (p1, p2) {\r\n            return Math.sqrt(Math.pow((p2.x - p1.x), 2) + Math.pow((p2.y - p1.y), 2));\r\n        },\r\n        calculateAngle: function (figureX, figureY, orignX, orignY) {\r\n            //正下方0 正上方180\r\n            var cx = figureX - orignX;\r\n            var cy = figureY - orignY;\r\n            var oAngle;\r\n            if (cy == 0 && cx == 0) {\r\n                oAngle = 0;\r\n            } else if (cy == 0 && cx != 0) {\r\n                if (cx > 0) {\r\n                    oAngle = -90;\r\n                } else {\r\n                    oAngle = 90;\r\n                }\r\n            } else if (cy != 0 && cx == 0) {\r\n                if (cy > 0) {\r\n                    oAngle = 0;\r\n                } else {\r\n                    oAngle = -180;\r\n                }\r\n            } else {\r\n                var tanValue = cx / cy;\r\n                if ((cy > 0 && cx > 0) || ((cx < 0 && cy > 0))) {\r\n                    oAngle = (Math.atan(tanValue) / Math.PI / 2) * 360;\r\n                } else if (cx < 0 && cy < 0) {\r\n                    oAngle = (Math.atan(tanValue) / Math.PI / 2) * 360 - 180;\r\n                } else {\r\n                    oAngle = (Math.atan(tanValue) / Math.PI / 2) * 360 + 180;\r\n                }\r\n            }\r\n            return -oAngle / 180 * Math.PI;\r\n        },\r\n        curve2equation: function (t, p0, p1, p2) {\r\n            return Math.pow((1 - t), 2) * p0 + 2 * (1 - t) * t * p1 + Math.pow(t, 2) * p2;\r\n        },\r\n        curve3equation: function (t, p0, p1, p2, p3) {\r\n            return Math.pow((1 - t), 3) * p0 + 3 * Math.pow((1 - t), 2) * t * p1 + 3 * (1 - t) * Math.pow(t, 2) * p2 + Math.pow(t, 3) * p3;\r\n        },\r\n        selectTrail: function () {\r\n            if (this.duration != 0) {\r\n\r\n                switch (this.trial) {\r\n                    case 'line':\r\n                        this._rateX = (this.endPos.x - this.startPos.x) / this.duration;\r\n                        this._rateY = (this.endPos.y - this.startPos.y) / this.duration;\r\n                        break;\r\n                    case 'curve2':\r\n                        if (!this.ctrlPos1) {\r\n                            this.ctrlPos1 = {\r\n                                x: Math.floor(Math.random() * this.canvasWidth),\r\n                                y: Math.floor(Math.random() * this.canvasHeight)\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'curve3':\r\n                        if (!this.ctrlPos1) {\r\n                            this.ctrlPos1 = {\r\n                                x: Math.floor(Math.random() * this.canvasWidth),\r\n                                y: Math.floor(Math.random() * this.canvasHeight)\r\n                            }\r\n                        }\r\n                        if (!this.ctrlPos2) {\r\n                            this.ctrlPos2 = {\r\n                                x: Math.floor(Math.random() * this.canvasWidth),\r\n                                y: Math.floor(Math.random() * this.canvasHeight)\r\n                            }\r\n                        }\r\n                        break;\r\n                    case 'tween':\r\n                        break;\r\n                    case 'round':\r\n                        this._r = this.getDistance(this.endPos, this.startPos);\r\n                        this._startAngle = this.calculateAngle(this.startPos.x, this.startPos.y, this.endPos.x, this.endPos.y);\r\n                        this._rateR = (this.rotatedir) ? (2 * Math.PI) / this.duration : (-2 * Math.PI) / this.duration;\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            } else {\r\n                return;\r\n            }\r\n        },\r\n        controlTime: function (mt) {\r\n            if (this._movedtime < this.duration) {\r\n                if (this.rotatecount != 0) {\r\n                    this._rotatedcount++;\r\n                }\r\n                this._movedtime += this._step;\r\n            } else {\r\n                if (this._rotatedcount > this.rotatecount && this.rotatecount != 0) {\r\n                    return;\r\n                } else {\r\n                    this._movedtime = 0;\r\n                }\r\n            }\r\n        },\r\n        calculatePos: function () {\r\n            var pos = {};\r\n            if (this.duration != 0) {\r\n\r\n                switch (this.trial) {\r\n                    case 'line':\r\n                        pos.x = this.startPos.x + this._rateX * this._movedtime;\r\n                        pos.y = this.startPos.y + this._rateY * this._movedtime;\r\n                        break;\r\n                    case 'curve2':\r\n                        var curt = this._movedtime / this.duration;\r\n                        pos.x = this.curve2equation(curt, this.startPos.x, this.ctrlPos1.x, this.endPos.x);\r\n                        pos.y = this.curve2equation(curt, this.startPos.y, this.ctrlPos1.y, this.endPos.y);\r\n                        break;\r\n                    case 'curve3':\r\n                        var curt = this._movedtime / this.duration;\r\n                        pos.x = this.curve3equation(curt, this.startPos.x, this.ctrlPos1.x, this.ctrlPos2.x, this.endPos.x);\r\n                        pos.y = this.curve3equation(curt, this.startPos.y, this.ctrlPos1.y, this.ctrlPos2.y, this.endPos.y);\r\n                        break;\r\n                    case 'tween':\r\n                        break;\r\n                    case 'round':\r\n                        var curAngle = this._startAngle + this._movedtime * this._rateR;\r\n                        if (curAngle > 180) {\r\n                            curAngle -= Math.PI * 2;\r\n                        } else if (curAngle < -180) {\r\n                            curAngle += Math.PI * 2;\r\n                        }\r\n                        pos.x = this.endPos.x + Math.sin(curAngle) * this._r;\r\n                        pos.y = this.endPos.y + Math.cos(curAngle) * this._r;\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            } else {\r\n                pos = this.startPos;\r\n            }\r\n            return pos;\r\n        },\r\n        controlMove: function (t) {\r\n            if (t > this.starttime) {\r\n                this.controlTime();\r\n                this.curPos = this.calculatePos();\r\n            }\r\n        }\r\n    }\r\n    zsj.Trail = Trail;\r\n})();"]}